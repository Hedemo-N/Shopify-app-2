<!DOCTYPE html>
<html lang="sv">
  <head>
    <meta charset="UTF-8" />
    <title>Blixt Delivery Admin</title>

    <!-- âœ” Shopify App Bridge CDN (korrekt & godkÃ¤nt) -->
  <script src="https://cdn.shopify.com/shopifycloud/app-bridge/v3/app-bridge.js"></script>
<script src="https://cdn.shopify.com/shopifycloud/app-bridge/v3/app-bridge-utils.js"></script>


    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
        max-width: 600px;
        margin: auto;
      }

      .input {
        width: 100%;
        padding: 10px;
        margin: 6px 0 16px 0;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 16px;
      }

      .top-box {
        flex: 1;
        padding: 14px;
        border-radius: 8px;
        background: #f6f6f6;
        border: 1px solid #ddd;
        cursor: pointer;
        font-size: 14px;
        text-align: center;
      }

      .top-box:hover {
        background: #ececec;
      }
    </style>
  </head>

  <body>
    <h1>Blixt Delivery Admin</h1>

    <!-- â­ App Bridge + session token logiken -->
   <script>
  console.log("ðŸš€ Blixt Admin kÃ¶rs!");

  const params = new URLSearchParams(window.location.search);
  const shop = params.get("shop");
  const host = params.get("host");

  if (window.top === window.self) {
    window.location.href = `/auth?shop=${shop}&host=${host}`;
  } else {
    const AppBridge = window["app-bridge"];
    const AppBridgeUtils = window["app-bridge-utils"];
    const { createApp } = AppBridge;
    const { getSessionToken, authenticatedFetch } = AppBridgeUtils;

    const app = createApp({
      apiKey: "f1ad1b493f65f36ffbc728cb00e594fe",
      host,
      forceRedirect: true,
    });

    const fetchWithAuth = authenticatedFetch(app);

    // ====== ðŸŸ¦ STEG 1: HÃ„MTA INSTÃ„LLNINGAR ======
    async function loadSettings() {
      const token = await getSessionToken(app);

      const res = await fetchWithAuth("/api/get-settings", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ shop }),
      });

      const data = await res.json();
      console.log("ðŸ“¥ HÃ¤mtade instÃ¤llningar:", data);

      document.getElementById("enable_ombud").checked = !!data.erbjuda_ombud;
      document.getElementById("enable_express").checked = !!data.erbjuda_hemleverans_express;
      document.getElementById("enable_evening").checked = !!data.erbjuda_hemleverans_kvall;
    }

    loadSettings();

    // ====== ðŸŸ© STEG 2: SPARA INSTÃ„LLNINGAR ======
    async function saveSettings() {
      const body = {
        shop,
        erbjuda_ombud: document.getElementById("enable_ombud").checked,
        erbjuda_hemleverans_express: document.getElementById("enable_express").checked,
        erbjuda_hemleverans_kvall: document.getElementById("enable_evening").checked,
      };

      const res = await fetchWithAuth("/api/update-settings", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body),
      });

      const out = await res.json();
      console.log("ðŸ“¤ Spara svar:", out);
      alert("InstÃ¤llningar sparade!");
    }

    window.saveSettings = saveSettings;
  }
</script>


    <!-- â­ DITT UI bÃ¶rjar hÃ¤r -->
    <div style="margin-top: 30px;">

      <!-- Top 3 options -->
      <!-- Delivery type checkboxes -->
<div style="margin-bottom: 24px;">
  <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer;">
    <input type="checkbox" id="enable_ombud" style="width: 20px; height: 20px;" />
    <span style="font-size: 16px;">Ombud</span>
  </label>

  <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer;">
    <input type="checkbox" id="enable_express" style="width: 20px; height: 20px;" />
    <span style="font-size: 16px;">Hemleverans Express</span>
  </label>

  <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
    <input type="checkbox" id="enable_evening" style="width: 20px; height: 20px;" />
    <span style="font-size: 16px;">Hemleverans KvÃ¤ll</span>
  </label>
</div>

<hr />


      <!-- Ombud Section -->
      <h2>Ombud</h2>
      <label>Pris (SEK)</label>
      <input class="input" id="price_ombud" type="number" placeholder="Ex. 29" />

      <label>Antal ombud som ska synas</label>
      <input class="input" id="count_ombud" type="number" placeholder="Ex. 3" />

      <label>Cutoff-tid</label>
      <input class="input" id="cutoff_ombud" type="time" />

      <p style="font-size: 12px; color: #666;">
        Ã„ndring av cutoff-tid krÃ¤ver manuell justering â€“ kontakta oss.
      </p>

      <hr />

      <!-- Express section -->
      <h2>Hemleverans Express</h2>

      <label>Pris (SEK)</label>
      <input class="input" id="price_express" type="number" placeholder="Ex. 49" />

      <hr />

      <!-- Evening -->
      <h2>Hemleverans KvÃ¤ll</h2>

      <label>Pris (SEK)</label>
      <input class="input" id="price_evening" type="number" placeholder="Ex. 59" />
<label>Cutoff-tid</label>
      <input class="input" id="cutoff_evening" type="time" />
      <p style="font-size: 12px; color: #666;">
        Ã„ndring av cutoff-tid krÃ¤ver manuell justering â€“ kontakta oss.
      </p>
<button onclick="saveSettings()" 
  style="margin-top: 20px; padding: 10px 20px; background:black; color:white; border-radius:8px;">
  Spara instÃ¤llningar
</button>
<hr />

      <hr />

      <p style="margin-top: 20px;">
        <strong>Kontakt:</strong><br />
        Niklas Hedemo<br />
        <a href="mailto:Niklas.Hedemo@blixtdelivery.se">Niklas.Hedemo@blixtdelivery.se</a>
      </p>
    </div>
    <!-- â­ DITT UI slutar hÃ¤r -->

  </body>
</html>
