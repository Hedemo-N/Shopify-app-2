<!DOCTYPE html>
<html lang="sv">
  <head>
    <meta charset="UTF-8" />
    <title>Blixt Delivery Admin</title>

    <!-- ‚úî Shopify App Bridge CDN (korrekt & godk√§nt) -->
    <script src="https://cdn.shopify.com/shopifycloud/app-bridge.js"></script>
    <script src="https://cdn.shopify.com/shopifycloud/app-bridge-utils.js"></script>

    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
        max-width: 600px;
        margin: auto;
      }

      .input {
        width: 100%;
        padding: 10px;
        margin: 6px 0 16px 0;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 16px;
      }

      .top-box {
        flex: 1;
        padding: 14px;
        border-radius: 8px;
        background: #f6f6f6;
        border: 1px solid #ddd;
        cursor: pointer;
        font-size: 14px;
        text-align: center;
      }

      .top-box:hover {
        background: #ececec;
      }
    </style>
  </head>

  <body>
    <h1>Blixt Delivery Admin</h1>

    <!-- ‚≠ê App Bridge + session token logiken -->
    <script>
      console.log("‚úÖ JS k√∂rs!");

      const params = new URLSearchParams(window.location.search);
      const shop = params.get("shop");
      const host = params.get("host");

      if (window.top === window.self) {
        console.warn("üö´ Appen k√∂rs utanf√∂r Shopify iframe ‚Äî omdirigerar...");
        if (shop) {
          window.location.href = `/auth?shop=${shop}&host=${host}`;
        } else {
          document.body.innerHTML += "<p>‚ùå Saknar shop-parameter.</p>";
        }
      } else {
        console.log("ü™ü Appen k√∂rs i iframe (embedded) 100% OK");

        const AppBridge = window["app-bridge"];
        const AppBridgeUtils = window["app-bridge-utils"];
        const { createApp } = AppBridge;
        const { getSessionToken, authenticatedFetch } = AppBridgeUtils;

        const app = createApp({
          apiKey: "f1ad1b493f65f36ffbc728cb00e594fe",
          host,
          forceRedirect: true,
        });

        const fetchWithAuth = authenticatedFetch(app);

        console.log("üöÄ H√§mtar session token...");
        getSessionToken(app)
          .then((token) => {
            console.log("üîë Token:", token);
            return fetchWithAuth("/api/ping");
          })
          .then((res) => res.json())
          .then((data) => console.log("üì¨ Ping:", data))
          .catch((err) => console.error("‚ùå Ping-fel:", err));
      }
    </script>

    <!-- ‚≠ê DITT UI b√∂rjar h√§r -->
    <div style="margin-top: 30px;">

      <!-- Top 3 options -->
      <!-- Delivery type checkboxes -->
<div style="margin-bottom: 24px;">
  <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer;">
    <input type="checkbox" id="enable_ombud" style="width: 20px; height: 20px;" />
    <span style="font-size: 16px;">Ombud</span>
  </label>

  <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer;">
    <input type="checkbox" id="enable_express" style="width: 20px; height: 20px;" />
    <span style="font-size: 16px;">Hemleverans Express</span>
  </label>

  <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
    <input type="checkbox" id="enable_evening" style="width: 20px; height: 20px;" />
    <span style="font-size: 16px;">Hemleverans Kv√§ll</span>
  </label>
</div>

<hr />


      <!-- Ombud Section -->
      <h2>Ombud</h2>
      <label>Pris (SEK)</label>
      <input class="input" id="price_ombud" type="number" placeholder="Ex. 29" />

      <label>Antal ombud som ska synas</label>
      <input class="input" id="count_ombud" type="number" placeholder="Ex. 3" />

      <label>Cutoff-tid</label>
      <input class="input" id="cutoff_ombud" type="time" />

      <p style="font-size: 12px; color: #666;">
        √Ñndring av cutoff-tid kr√§ver manuell justering ‚Äì kontakta oss.
      </p>

      <hr />

      <!-- Express section -->
      <h2>Hemleverans Express</h2>

      <label>Pris (SEK)</label>
      <input class="input" id="price_express" type="number" placeholder="Ex. 49" />

      <hr />

      <!-- Evening -->
      <h2>Hemleverans Kv√§ll</h2>

      <label>Pris (SEK)</label>
      <input class="input" id="price_evening" type="number" placeholder="Ex. 59" />
<label>Cutoff-tid</label>
      <input class="input" id="cutoff_ombud" type="time" />
      <p style="font-size: 12px; color: #666;">
        √Ñndring av cutoff-tid kr√§ver manuell justering ‚Äì kontakta oss.
      </p>

      <hr />

      <p style="margin-top: 20px;">
        <strong>Kontakt:</strong><br />
        Niklas Hedemo<br />
        <a href="mailto:Niklas.Hedemo@blixtdelivery.se">Niklas.Hedemo@blixtdelivery.se</a>
      </p>
    </div>
    <!-- ‚≠ê DITT UI slutar h√§r -->

  </body>
</html>
